{% load static %}
{% load sass_tags %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Voxo">
    <meta name="keywords" content="Voxo">
    <meta name="author" content="Voxo">
    <link rel="icon" href="  {% static 'assets/images/favicon/2.png' %}" type="image/x-icon" />
    <title>Create New Password</title>

    <!--Google font-->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- bootstrap css -->
    <link id="rtl-link" rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/bootstrap.scss' %}">

    <!-- font-awesome css -->
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/font-awesome.scss' %}">

    <!-- feather icon css -->
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/feather-icon.scss' %}">

    <!-- animation css -->
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/vendors/animate.css' %}">

    <!-- slick css -->
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/slick/slick.scss' %}">
    <link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/slick/slick-theme.scss' %}">

    <!-- Theme css -->
    <link id="color-link" rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/demo2.scss' %}">

</head>

<body class="theme-color2 light ltr">


    <!-- Sign Up Section Start -->
    <div class="login-section">
        <div class="materialContainer">
            <div class="box">
                <div class="login-title">
                    {% include 'includes/alerts.html' %}
                    <h2>Reset Password</h2>
                </div>
                <form action="{% url 'update_password' %}" method="post">
                    {% csrf_token %}
                    <div class="input">
                        <label for="newpass">New Password</label>
                        <input type="text" name="newpass" class="is-invalid" id="newpass" required>
                        <span class="spin"></span>
                    </div>

                    <div class="input">
                        <label for="confnewpass">Confirm New Password</label>
                        <input type="text" name="confnewpass" class="is-invalid" id="confnewpass" required>
                        <span class="spin"></span>
                    </div>

                    <div class="button login button-1">
                        <button onclick="location.href = ">
                            <span>Submit</span>
                            <i class="fa fa-check"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Sign Up Section End -->

    <!-- theme Setting Start -->
    <div class="theme-setting">
        <ul>
            <li>
                <button id="darkButton" class="btn btn-sm dark-buttton">Dark</button>
            </li>
            <li>
                <button class="btn btn-sm rtl-button">RTL</button>
            </li>
            <li class="color-picker">
                <input type="color" class="form-control form-control-color" id="ColorPicker1" value="#e22454"
                    title="Choose your color">
            </li>
        </ul>
    </div>
    <!-- theme Setting End -->

    <div class="bg-overlay"></div>

    <!-- latest jquery-->
<script src="{% static 'assets/js/jquery-3.3.1.min.js' %}" ></script>

<!-- menu js-->
<script src="{% static 'assets/js/menu.js' %}"></script>



<!-- tool tip js -->
<script src="{% static 'assets/js/tippy-popper.min.js' %}"></script>
<script src="{% static 'assets/js/tippy-bundle.iife.min.js' %}"></script>

<!-- popper js-->
<script src="{% static 'assets/js/popper.min.js' %}" ></script>

<!-- father icon -->
<script src="{% static 'assets/js/feather.min.js' %}"></script>
<script src="{% static 'assets/js/feather-icon.js' %}"></script>


<!-- slick js-->
<script  src="{% static 'assets/js/slick.js' %}"></script>

<!-- Bootstrap js-->
<script src="{% static 'assets/js/bootstrap.js' %}" ></script>

<!-- Theme js-->
<script src="{% static 'assets/js/script.js' %}" ></script>
</body>
</html>









<script>

    <script>
        function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(";");
            for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              // Does this cookie string begin with the name we want?
              if (cookie.substring(0, name.length + 1) === name + "=") {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
              }
            }
          }
          return cookieValue;
        }
        var csrftoken = getCookie("csrftoken");

        async function GetConvertedValues(value) {
          var url = "{% url 'get_selected_currency' %}",
            valuereturn = 0;
          await fetch(url, {
              method: "GET",
              headers: {
                "Content-type": "application/json",
                "X-CSRFToken": csrftoken,
              },
            })
            .then((response) => {
              return response.json();
            })
            .then((data) => {
              (valuereturn = (data.factor * value).toFixed(2)), (symbol = data.symbol);
            });
          return {
            symbol: symbol,
            value: valuereturn
          };
        }

        async function GetConvertedRangeValues(value1, value2) {

          var url = "{% url 'get_selected_currency' %}",
            valuereturn1 = 0,
            valuereturn2 = 0;
          await fetch(url, {
              method: "GET",
              headers: {
                "Content-type": "application/json",
                "X-CSRFToken": csrftoken,
              },
            })
            .then((response) => {
              return response.json();
            })
            .then((data) => {
              (valuereturn1 = (data.factor * value1).toFixed(2)),
              (valuereturn2 = (data.factor * value2).toFixed(2)),
              (symbol = data.symbol);
            });
          return {
            symbol: symbol,
            value1: valuereturn1,
            value2: valuereturn2
          };
        }

        async function handleQuickView(params) {
          var url = "{% url 'quick_view' %}";
          await fetch(url, {
              method: "POST",
              headers: {
                "Content-type": "application/json",
                "X-CSRFToken": csrftoken,
              },
              body: JSON.stringify({
                productId: params.productId,
                productVariantId: params.productVariantId,
              }),
            })
            .then((response) => {
              return response.json();
            })
            .then((data) => {
              let id = data.productId;
              let firstProductVariant = data.firstProductVariant;

              console.log('--------singleImage>>>>', data.singleImage);
              // console.log('--------multipleImages>>>>',data.multipleImages);

              var productDetailsAtQuickView = document.getElementById('product-details');
              if (productDetailsAtQuickView) {
                productDetailsAtQuickView.remove();
              }

              // Code to render out multiple images in quick model view START -------------------------------------------------
              var quickViewImg = document.getElementById("quickViewImage");
              quickViewImg.setAttribute('src', data.singleImage)
              var element = document.getElementById("quickViewImagesDiv");
              element.style.backgroundImage = 'url("' + data.singleImage + '")';

              // Code to render out multiple images in quick model view END ---------------------------------------------------


              // ================= for rating ==================
              let productRatingDiv = document.getElementById("productRating");
              productRatingDiv.innerHTML = "";

              for (let j = 1; j <= 5; j++) {
                let ratingLi = document.createElement("li"),
                  icon = document.createElement("i");
                icon.setAttribute("class", "fas fa-star");
                if (j <= data.productFinalRating) {
                  icon.classList.add("theme-color");
                }
                ratingLi.appendChild(icon);
                productRatingDiv.appendChild(ratingLi);
              }
              let stockStatusLi = document.createElement("li");
              stockStatusLi.setAttribute("class", "font-light");
              stockStatusLi.setAttribute("id", "stockStatus");
              productRatingDiv.appendChild(stockStatusLi);

              // ================= for rating ends==================

              document.getElementById("productName").innerHTML = data.productName;
              document.getElementById("stockStatus").innerHTML =
                "( " + data.productStockStatus + " )";
              // console.log("$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$", data);

              document.getElementById("productPrice").innerHTML =
                data.productVariantMinPrice +
                "-" +
                data.productVariantMaxPrice;
              // document.getElementById('productPrice').innerHTML = data.productFinalPrice + ".00";




              if (data.productType == "Simple") {
                GetConvertedValues(data.productVariantPrice1).then((Data) => {
                  document.getElementById("productPrice").innerHTML =
                    Data.symbol + " " + Data.value;
                });
                GetConvertedValues(data.productVariantActualPrice).then((Data) => {
                  document.getElementById("actualPriceAtQuickView").innerHTML =
                    Data.symbol + " " + Data.value;
                });

                document.getElementById("discountPercentageAtQuickView").innerHTML = data
                  .productVariantDiscount;
                // document.getElementById("productPrice").innerHTML =data.productVariantPrice1 +".00";
              }
              if (data.productType == "Classified") {
                GetConvertedRangeValues(
                  data.productVariantMinPrice,
                  data.productVariantMaxPrice
                ).then((Data) => {
                  document.getElementById("productPrice").innerHTML =
                    Data.symbol +
                    " " +
                    Data.value1
                    //  +
                    // " - " +
                    // Data.symbol +
                    // " " +
                    // Data.value2;
                });

                //document.getElementById("productPrice").innerHTML =data.productVariantMinPrice +"-" +data.productVariantMaxPrice +".00";
                GetConvertedRangeValues(
                  data.productVariantMinActualPrice,
                  data.productVariantMaxActualPrice
                ).then((Data) => {
                  document.getElementById("actualPriceAtQuickView").innerHTML =
                    Data.symbol +
                    " " +
                    Data.value1
                    //  +
                    // " - " +
                    // Data.symbol +
                    // " " +
                    // Data.value2;
                });

                document.getElementById("discountPercentageAtQuickView").innerHTML = data
                  .productVariantDiscountRange;
              }

              if (data.productType == "Simple") {
                var flag = document.getElementById("attrSuperDiv");
                if (flag) {
                  flag.remove();
                }
              }


              if (data.productType == "Classified") {

                var attributeObjects = data.attributeObjects
                var attributeObjectsLength = data.attributeObjects.length
                var flag = document.getElementById("attrSuperDiv");
                if (flag) {
                  flag.remove();
                }
                var priceLabel2 = document.getElementById("priceLabel2");
                let attrSuperDiv = document.createElement("div");
                attrSuperDiv.id = "attrSuperDiv";
                for (let i = 0; i < attributeObjects.length; i++) {
                  for (let attrName in attributeObjects[i]) {

                    var falg = document.getElementById(attrName + "DivId");

                    let attrValues = attributeObjects[i][attrName];

                    let attrDiv = document.createElement("div");
                    attrDiv.className = attrName.toLowerCase() + "-types size-detail";
                    attrDiv.setAttribute("id",attrName.toLowerCase()+"-id")

                    let heading = document.createElement("h4");
                    heading.textContent = attrName;
                    heading.id = attrName + "DivId"


                    let ul = document.createElement("ul");
                    


                    for (let j = 0; j < attrValues.length; j++) {
                      let li = document.createElement("li");

                      let liId = attrName.toLowerCase() + "UlLi" + j;
                      li.setAttribute("id", liId);

                      let a = document.createElement("a");
                      let aId = attrName.toLowerCase() + "A" + j;
                      a.setAttribute("id", aId);
                      let fun =
                        "show_details_for_quick_view({attributeObjectsIds:'" + data
                        .attributeObjectsIds + "',clickedEleId: '" +
                        aId + "', eleLen: '" +
                        attrValues.length + "', key: 'selected" +
                        attrName + "AtQuickView', value: '" +
                        attrValues[j] + "',ulDiv:'"+attrName.toLowerCase()+"', id: '" +
                        data.productId + "'})";
                      a.setAttribute("onClick", fun);

                      let liContent = document.createElement("li");
                      liContent.setAttribute("class", attrName.toLowerCase() + "Li");
                      liContent.innerHTML = attrValues[j];

                      li.appendChild(a);
                      a.appendChild(liContent);
                      ul.appendChild(li);
                    }
                    // Create hidden input field for attribute
                    let input = document.createElement("input");
                    input.type = "hidden";
                    input.name = attrName.toLowerCase();
                    // input.value = attrName;
                    input.id = "selected" + attrName + "AtQuickView";
                    attrDiv.appendChild(input);

                    attrDiv.appendChild(heading);
                    attrDiv.appendChild(ul);


                    priceLabel2.appendChild(attrSuperDiv);
                    attrSuperDiv.appendChild(attrDiv);

                  }
                }
              }



              let url1 = "add_to_cart_fun_at_quick_view({key:'test'})".replace(
                "test",
                firstProductVariant.toString()
              );
              document.getElementById("addToCart").setAttribute("onClick", url1);

              let url2 = "{% url 'left_slidebar' 'test' %}".replace(
                "test",
                id.toString()
              );
              document.getElementById("productLeftSlidebar").setAttribute("href", url2);

              var images = document.getElementsByClassName("product-quick-view");

              // for (var i = 0; i < images.length; i++) {
              //   images[i].setAttribute("src", data.multipleImages);
              //   if (images[i].classList.contains("bg-img")) {
              //     images[i].parentElement.style.backgroundImage = `url("${data.multipleImages}")`;
              //   }
              // }

              // Code to render out product details like Category and Brand in quick model view START -------------------------

              const div = document.createElement("div");
              div.className = "product-details";
              div.id = "product-details"


              const h4 = document.createElement("h4");
              h4.textContent = "product details";
              div.appendChild(h4);

              const ul = document.createElement("ul");

              const li1 = document.createElement("li");
              const span1 = document.createElement("span");
              span1.className = "font-light";
              span1.textContent = "Brand :";
              li1.appendChild(span1);
              li1.appendChild(document.createTextNode(data.brand));
              ul.appendChild(li1);

              const li2 = document.createElement("li");
              const span2 = document.createElement("span");
              span2.className = "font-light";
              span2.textContent = "Category :";
              li2.appendChild(span2);
              li2.appendChild(document.createTextNode(data.category));
              ul.appendChild(li2);

              div.appendChild(ul);

              // var attrSuperDiv = document.getElementById("attrSuperDiv");
              // 
              // if (attrSuperDiv) {
              //   attrSuperDiv.after(div);
              // } else {
              // var priceLabelAtQuickView = document.getElementById("priceLabel2");
              //   priceLabelAtQuickView.after(div);
              // }
              var priceLabelAtQuickView = document.getElementById("priceLabel2");
              priceLabelAtQuickView.after(div);
              // Code to render out product details like Category and Brand in quick model view End ---------------------------

              // Code to render out multiple images in quick model view START -------------------------------------------------

              // Code to render out multiple images in quick model view END ---------------------------------------------------
            });
        }

        function removeElementsByClass(className) {
          const elements = document.getElementsByClassName(className);
          while (elements.length > 0) {
            elements[0].parentNode.removeChild(elements[0]);
          }
        }

        //------------------------------

        async function show_details_for_quick_view(params) {
          console.log('=======params params params=====>', params)
          var ulElement = document.getElementById(params.ulDiv+"-id")
          var activeElements = ulElement.querySelectorAll(".active");
          activeElements.forEach(function (element) {
            element.classList.remove("active");
            element.style.backgroundColor = "";
          });
          document.getElementById(params.clickedEleId).setAttribute("class", "active")
          document.getElementById(params.clickedEleId).style.backgroundColor = "#bfbfbf";
          document.getElementById(params.key).setAttribute('value', params.value)



          const attributes = params.attributeObjectsIds.split(',');

          var allAttributesFilled = true;

          for (var i = 0; i < attributes.length; i++) {
            var attributeValue = document.getElementById(attributes[i]).getAttribute("value");
            if (!attributeValue || attributeValue.length === 0) {
              allAttributesFilled = false;
              break;
            }
          }
          if (allAttributesFilled) {
            var selectedAttributeValueDict = {}
            for (var i = 0; i < attributes.length; i++) {
              var attributeName = attributes[i];
              var selectedAttributeValue = document.getElementById(attributes[i]).getAttribute(
                "value");
              // Perform any desired operations with selectedAttributeValue
              selectedAttributeValueDict[attributeName] = selectedAttributeValue;
            }
            console.log('88888888888888888888888888888===selectedAttributeValueDict',
              selectedAttributeValueDict)

            var url = "{% url 'get_product_variant' %}";
            await fetch(url, {
                method: "POST",
                headers: {
                  "Content-type": "application/json",
                  "X-CSRFToken": csrftoken,
                },
                body: JSON.stringify({
                  productId: params.id,
                  selectedAttributeValueDict: selectedAttributeValueDict,
                }),
              })
              .then((response) => {
                return response.json();
              })
              .then((data) => {
                if (data.productVariantPrice == "Product Out Of Stock") {
                  document.getElementById("productPrice").innerHTML = data.productVariantPrice;
                  document.getElementById("actualPriceAtQuickView").innerHTML = "";
                  document.getElementById("discountPercentageAtQuickView").innerHTML = "";
                } else {
                  GetConvertedValues(data.productVariantPrice).then((Data) => {
                    document.getElementById("productPrice").innerHTML = Data.symbol + " " + Data
                      .value;
                  });

                  GetConvertedValues(data.productVariantActualPrice).then((Data) => {
                    document.getElementById("actualPriceAtQuickView").innerHTML = Data.symbol +
                      " " + Data.value;
                  });

                  document.getElementById("discountPercentageAtQuickView").innerHTML = data
                    .productVariantDiscount + "%";



                }
                let urlForAddToCartAddToCart =
                  "add_to_cart_fun_at_quick_view({key:'firstProductVariant'})";
                urlForAddToCartAddToCart = urlForAddToCartAddToCart.replace("firstProductVariant",
                  data.productVariantId.toString());
                document.getElementById("addToCart").setAttribute("onClick",
                  urlForAddToCartAddToCart);

              });

          }


          // WORK FROM HERE==========================================================================

        }

        function add_to_cart_fun_at_quick_view(params) {
          let quantityValue = 1;
          if (params.key == "No Product Yet") {} else {
            let url = "{% url 'add_to_cart' 'id' 'quantity' %}";
            url = url.replace("id", params.key);
            url = url.replace("quantity", quantityValue);
            fetch(url, {
              method: "GET",
              headers: {
                "Content-type": "application/json",
                "X-CSRFToken": csrftoken,
              },
            });
            window.location.reload();
          }
        }
      </script>

</script>